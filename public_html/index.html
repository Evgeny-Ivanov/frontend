<!DOCTYPE  html>
<html><head>
    <meta charset="utf-8" />
    <title>My Super Game</title>
    <link rel="stylesheet" href="/css/main.css" />
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <script src="/js/lib/jquery.js"></script>
    <script src="/js/tmpl/scoreboard.js"></script>
    <script src="/js/tmpl/main.js"></script>
    <script src="/js/tmpl/game.js"></script>
    <script src="/js/tmpl/login.js"></script>
</head><body>
    <div id="page"></div>
    <script>
        var $page = $('#page');


        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie != '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) == (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        function ajaxAuthorization(){
 
            var csrftoken = getCookie('csrftoken');

            var csrfSafeMethod = function (method) {
                return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
            }

            setting = {

                type: "POST",
                url: "/api/v1/auth/signin",
                dataType: 'json',

                error : function(xhr, status, error) {
                           alert(xhr.responseText + '|\n' + status + '|\n' +error);
                        },

                beforeSend : function(xhr, settings) {

                                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                                xhr.setRequestHeader("X-CSRFToken", csrftoken);
                                }

                             },

                success : function(answer){
                            alert('success');
                          }

            }

            var password = $("#inputPassword3").val();
            var email = $('#inputEmail3').val();

            console.log('email = '+email);

            setting.data = {"email": email,"password":password};

            $.ajax(setting);



        }

        function showScoreboardScreen() {
            console.log("showScoreboardScreen");

            hideMainScreen();
            $page.html(scoreboardTmpl());

            $page.find('.back-in-main-menu').on('click',showMainScreen);
        }
        function hideScoreboardScreen() {
            $page.find('.back-in-main-menu').off('click',showMainScreen);
        }

        function showGameScreen() {
            console.log("showGameScreen");

            hideMainScreen();
            $page.html(gameTmpl());

            $page.find('.back-in-main-menu').on('click',showMainScreen);
        }
        function hideGameScreen() {
            $page.find('.back-in-main-menu').off('click',showMainScreen);
        }

        function showLoginScreen() {   
            console.log("showLoginScreen");

            hideMainScreen();
            $page.html(loginTmpl());

            $page.find('.back-in-main-menu').on('click',showMainScreen);
        }
        function hideLoginScreen() {
            $page.find('.back-in-main-menu').off('click',showMainScreen);
        }

        function showMainScreen() {// Конструктор экрана "Главный"
            console.log("showMainScreen");
            $page.html(mainTmpl()); // Рендерим шаблон
            // Инициализируем обработчики событий
            $page.find('.js-scoreboard').on('click', showScoreboardScreen); 
            $page.find('.js-start-game').on('click', showGameScreen);
            $page.find('.js-login').on('click',showLoginScreen);
        }
        function hideMainScreen() {// Деструктор экрана "Главный"
            // Удаляем установленные обработчики событий
            $page.find('.js-scoreboard').off('click', showScoreboardScreen);
            $page.find('.js-start-game').off('click', showGameScreen);
            $page.find('.js-login').on('click',showLoginScreen);
        }

        console.log("start");
        showMainScreen();

    </script>
    
    <!-- Livereload -->
    <script src="//localhost:35729/livereload.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
</body></html>
